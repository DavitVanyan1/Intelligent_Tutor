{% extends 'base.html' %}
{% block content %}
<div class="quiz-review-container">
  <div class="review-header">
    <h2 class="review-title">üìä Quiz Review: {{ topic_title }}</h2>
    <div class="score-summary">
      <div class="score-circle">
        <span class="score-text">{{ score }}%</span>
        <span class="score-label">Score</span>
      </div>
      <div class="stats-grid">
        <div class="stat-item correct">
          <span class="stat-number">{{ correct_count }}</span>
          <span class="stat-label">Correct</span>
        </div>
        <div class="stat-item incorrect">
          <span class="stat-number">{{ incorrect_count }}</span>
          <span class="stat-label">Incorrect</span>
        </div>
        <div class="stat-item total">
          <span class="stat-number">{{ total_questions }}</span>
          <span class="stat-label">Total</span>
        </div>
      </div>
    </div>
  </div>

  <div class="questions-review">
    {% for q in quiz_data %}
      <div class="review-card fade-in" style="animation-delay: 100ms;">
        <div class="question-header">
          <span class="question-number">{{ loop.index }}</span>
          <h3 class="question-text">{{ q['question'] }}</h3>
          <div class="result-badge {{ 'correct' if user_answers[q['question']] == q['answer'] else 'incorrect' }}">
            {% if user_answers[q['question']] == q['answer'] %}
              <svg class="result-icon" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
              </svg>
            {% else %}
              <svg class="result-icon" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
              </svg>
            {% endif %}
          </div>
        </div>
        
        <div class="answers-section">
          {% if q.type == 'multiple_choice' %}
            <div class="options-grid">
              {% for opt in q.options %}
                <div class="option-review 
                  {% if opt == q['answer'] %}correct-answer{% endif %}
                  {% if opt == user_answers[q['question']] and opt != q['answer'] %}user-wrong{% endif %}
                  {% if opt == user_answers[q['question']] and opt == q['answer'] %}user-correct{% endif %}">
                  
                  <div class="option-indicator">
                    {% if opt == q['answer'] %}
                      <svg class="indicator-icon correct" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                      </svg>
                    {% elif opt == user_answers[q['question']] and opt != q['answer'] %}
                      <svg class="indicator-icon incorrect" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                      </svg>
                    {% else %}
                      <div class="indicator-circle"></div>
                    {% endif %}
                  </div>
                  
                  <span class="option-text">{{ opt }}</span>
                  
                  {% if opt == user_answers[q['question']] %}
                    <span class="selection-label">Your Answer</span>
                  {% endif %}
                  {% if opt == q['answer'] %}
                    <span class="correct-label">Correct Answer</span>
                  {% endif %}
                </div>
              {% endfor %}
            </div>
          
          {% elif q.type == 'true_false' %}
            <div class="true-false-review">
              <div class="option-review 
                {% if 'True' == q['answer'] %}correct-answer{% endif %}
                {% if 'True' == user_answers[q['question']] and 'True' != q['answer'] %}user-wrong{% endif %}
                {% if 'True' == user_answers[q['question']] and 'True' == q['answer'] %}user-correct{% endif %}">
                
                <div class="option-indicator">
                  {% if 'True' == q['answer'] %}
                    <svg class="indicator-icon correct" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                  {% elif 'True' == user_answers[q['question']] and 'True' != q['answer'] %}
                    <svg class="indicator-icon incorrect" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                  {% else %}
                    <div class="indicator-circle"></div>
                  {% endif %}
                </div>
                
                <span class="option-text">‚úì True</span>
                
                {% if 'True' == user_answers[q['question']] %}
                  <span class="selection-label">Your Answer</span>
                {% endif %}
                {% if 'True' ==q['answer'] %}
                  <span class="correct-label">Correct Answer</span>
                {% endif %}
              </div>
              
              <div class="option-review 
                {% if 'False' ==q['answer'] %}correct-answer{% endif %}
                {% if 'False' == user_answers[q['question']] and 'False' !=q['answer'] %}user-wrong{% endif %}
                {% if 'False' == user_answers[q['question']] and 'False' ==q['answer'] %}user-correct{% endif %}">
                
                <div class="option-indicator">
                  {% if 'False' ==q['answer'] %}
                    <svg class="indicator-icon correct" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                  {% elif 'False' == user_answers[q['question']] and 'False' !=q['answer'] %}
                    <svg class="indicator-icon incorrect" fill="currentColor" viewBox="0 0 20 20">
                      <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                  {% else %}
                    <div class="indicator-circle"></div>
                  {% endif %}
                </div>
                
                <span class="option-text">‚úó False</span>
                
                {% if 'False' == user_answers[q['question']] %}
                  <span class="selection-label">Your Answer</span>
                {% endif %}
                {% if 'False' ==q['answer'] %}
                  <span class="correct-label">Correct Answer</span>
                {% endif %}
              </div>
            </div>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
  
  <div class="mt-10">
    <a href="{{ url_for('teaching.teaching', topic_id=topic_id) }}" class="btn btn-secondary bg-orange-500 hover:bg-orange-700 text-white px-6 py-3 rounded-xl shadow transition">‚û°Ô∏è Continue to Teaching Section</a>
  </div>
  
</div>

{% endblock %}